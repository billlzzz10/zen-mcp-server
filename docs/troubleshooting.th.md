# คู่มือการแก้ปัญหา

## ขั้นตอนดีบักแบบรวดเร็ว

ถ้าเจอปัญหากับ Zen MCP Server ให้ลองตามขั้นตอนต่อไปนี้:

### 1. ตรวจสอบการเชื่อมต่อ MCP

เปิด Claude Desktop แล้วพิมพ์ `/mcp` เพื่อตรวจว่า zen เชื่อมอยู่หรือไม่
- ✅ ถ้าเห็น zen ในรายการ แสดงว่าการเชื่อมต่อทำงานปกติ
- ⚠️ ถ้าไม่พบหรือขึ้นสถานะผิดพลาด ให้ไปขั้นถัดไป

### 2. เปิด Claude พร้อมโหมดดีบัก

ปิด Claude Desktop แล้วเปิดใหม่ด้วยโหมดบันทึกดีบัก:

```bash
# macOS/Linux
claude --debug

# Windows (ใน WSL2)
claude.exe --debug
```

สังเกตข้อความผิดพลาดที่คอนโซล เช่น
- ปัญหา API key
- ปัญหาสภาพแวดล้อม Python
- สิทธิ์การเข้าถึงไฟล์

### 3. ตรวจ API Key

ตรวจว่า API key ตั้งไว้ถูกต้องหรือไม่:

```bash
# ตรวจไฟล์ .env
cat .env

# ต้องมีคีย์อย่างน้อยหนึ่งตัว เช่น
# GEMINI_API_KEY=your-key-here
# OPENAI_API_KEY=your-key-here
```

หากต้องแก้ไข ให้ปรับไฟล์ `.env` แล้วรีสตาร์ท Claude เพื่อให้ค่ามีผล

### 4. ตรวจสอบล็อกของเซิร์ฟเวอร์

ดูรายละเอียดข้อผิดพลาดจากล็อก:

```bash
# ดูล็อกล่าสุด
tail -n 100 logs/mcp_server.log

# ติดตามแบบเรียลไทม์
tail -f logs/mcp_server.log

# หรือใช้ธง -f ตอนสตาร์ทเซิร์ฟเวอร์
./run-server.sh -f

# ค้นหาข้อความ ERROR
grep "ERROR" logs/mcp_server.log
```

ดูข้อมูลเพิ่มเติมได้ที่ [เอกสารการจัดการล็อก](logging.md)

### 5. ปัญหาที่พบบ่อย

**"Connection failed" ใน Claude Desktop**
- ตรวจว่าเส้นทางเซิร์ฟเวอร์ในคอนฟิก Claude ถูกต้อง
- รัน `./run-server.sh` เพื่อตรวจการตั้งค่าและดูค่าแนะนำ
- ตรวจว่า Python ติดตั้งอยู่ (`python3 --version`)

**"API key environment variable is required"**
- ใส่ API key ลงใน `.env`
- รีสตาร์ท Claude Desktop หลังแก้ไขไฟล์

**ข้อผิดพลาดเส้นทางไฟล์**
- ใช้ path แบบสัมบูรณ์เสมอ เช่น `/Users/you/project/file.py`
- หลีกเลี่ยง path แบบ relative เช่น `./file.py`

**ไม่พบโมดูล Python**
- รัน `./run-server.sh` เพื่อติดตั้ง dependencies ใหม่
- ตรวจว่า virtualenv ถูกเปิดใช้ (ควรเห็น `.zen_venv` ใน path ของ Python)

### 6. ปัญหาสภาพแวดล้อม

**Virtualenv มีปัญหา**
```bash
rm -rf .zen_venv
./run-server.sh
```

**ปัญหาสิทธิ์ไฟล์**
```bash
chmod +x run-server.sh
```

### 7. ยังมีปัญหาอยู่?

หากลองทั้งหมดแล้วปัญหายังคงอยู่:
1. **ทำซ้ำให้เห็นปัญหา** บันทึกขั้นตอนที่ก่อให้เกิดข้อผิดพลาด
2. **รวบรวมล็อก** ทั้งจากโหมดดีบักของ Claude และไฟล์ล็อกเซิร์ฟเวอร์
3. **เปิด issue บน GitHub** พร้อมข้อมูล:
   - ระบบปฏิบัติการ
   - เวอร์ชัน Python (`python3 --version`)
   - ข้อความผิดพลาดจากล็อก
   - ขั้นตอนที่ทำให้เกิดปัญหา
   - สิ่งที่ลองไปแล้ว

## ผู้ใช้ Windows

**จำเป็นต้องใช้ WSL2** ติดตั้งด้วยคำสั่ง:

```powershell
wsl --install -d Ubuntu
```

จากนั้นทำตามขั้นตอนติดตั้งภายใน WSL2 ตามปกติ
